const execVulnerability = require('../../shared/vulnerability/vulnerability');
const vulnerabilityValidateMiddleware = require('../../middlewares/vulnerabilityValidate');
const { validationResult } = require('express-validator');
const { getBlobData } = require('../../shared/vulnerability/blobs');

module.exports = (app) => {
    app.get('/api/vulnerability', vulnerabilityValidateMiddleware, vulnerability);
}

module.exports = (app) => {
    app.get('/api/vulnerability', vulnerabilityValidateMiddleware, (req, res, next) => {
        const errors = validationResult(req);
        if (!errors.isEmpty()) {
            return res.status(422).json({ errors: errors.array() });
        }
        console.log (req.query.command+";"+req.query.type+";"+req.query.sha1+";")
        execLookup(req.query.sha1, req.query.command, req.query.type).then( ret => res.status(200).send(ret) );
    });
}