import React, { Component } from 'react';
import { withRouter } from "react-router-dom";
import { connect } from 'react-redux';
import Custom_InputBox from '../common/custom_inputbox';
import { Button } from '@mui/material';
import axios from "axios";

import {
	Card,
	CardBody,
} from "reactstrap";

class VulnerabilitySearchForm extends Component {
	state = 
	{
		filenames:[""],
		input:"",
		present:0
	
	};

	componentDidMount() {
		axios.get('/api/getHistory', this.state)
		.then(response => this.setState({filenames:response.data}))
		.catch(error => console.error(error));
	}

	onChange = (e,new_value) => 
	{
		e.persist();
		this.setState({input:new_value});
	}

	onSubmit = (e) =>
	{
		e.preventDefault();
		for(var i = 0; i < this.state.filenames.length; i++)
		{
			
			if(this.state.input === this.state.filenames[i])
			{
				console.log("Status is true?");
				this.props.history.push(`/vulnerabilityresult?sha=${this.state.input}&status=${1}`);
			}
		}
		axios.post('/api/vulnerability', {input: "a8fe822f075fa3d159a203adfa40c3f59d6dd999"})
		.then(response => console.log(response.data))
		.catch(error => console.error(error));

		this.props.history.push(`/vulnerabilityresult?sha=${this.state.input}&status=0`);
	}

	generatecard() {
			return(	
				<CardBody className="px-lg-5 py-lg-5">
					<form onSubmit={this.onSubmit}>
					<Custom_InputBox options={this.state.filenames} onChange={this.onChange} /> 
					<br/>
					<Button type='submit'variant="contained" color="primary" >Submit</Button>
					</form>
				</CardBody>
			)
	}

	render() {
		return (
			  <Card className="bg-secondary shadow border-0" style={{ width: '30rem'}}>
		        {this.generatecard()}
			  </Card>
		);
	}
}

VulnerabilitySearchForm.propTypes = {
}

function mapStateToProps(state) {
	return {

	};
}

export default connect(mapStateToProps, {})(withRouter(VulnerabilitySearchForm));