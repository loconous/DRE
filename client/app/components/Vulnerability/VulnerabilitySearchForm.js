import React, { Component } from 'react';
import { withRouter } from "react-router-dom";
import { connect } from 'react-redux';
import Custom_InputBox from '../common/custom_inputbox';
import { Button } from '@mui/material';
import axios from "axios";

import {
	Card,
	CardBody,
} from "reactstrap";

class VulnerabilitySearchForm extends Component {
	state = 
	{
		filenames:[""],
		input:"",
		present:0
	
	};

	componentDidMount() {
		axios.get('/api/getHistory', this.state)
		.then(response => this.setState({filenames:response.data}))
		.catch(error => console.error(error));
	}

	onChange = (e,new_value) => 
	{
		e.persist();
		this.setState({input:new_value});
	}

	onSubmit = (e) =>
	{
		e.preventDefault();
		let hasCachedResults = false;

		if(this.state.filenames.includes(this.state.input)) {
			hasCachedResults = true;
		} 
		if(hasCachedResults) {
			this.props.history.push(`/vulnerabilityresult?sha=${this.state.filenames[this.state.filenames.indexOf(this.state.input)]}&status=${hasCachedResults}`) 
		} else {
			this.props.history.push(`/vulnerabilityresult?sha=${this.state.input}&status=${hasCachedResults}`);
		}

		// for(var i = 0; i < this.state.filenames.length; i++)
		// {
			
		// 	if(this.state.input === this.state.filenames[i])
		// 	{
		// 		console.log("Status is true?");
		// 		this.props.history.push(`/vulnerabilityresult?sha=${this.state.input}&status=${1}`);
		// 	}
		// }
		//Test sha (from woc-tools): 4c84a332101eaee6d857d8c093ac7fd236098a1d
		//Test sha (license file form woc tutorial): a8fe822f075fa3d159a203adfa40c3f59d6dd999
		

		//this.props.history.push(`/vulnerabilityresult?sha=${this.state.input}&status=0`);
	}

	generatecard() {
			return(	
				<CardBody className="px-lg-5 py-lg-5">
					<form onSubmit={this.onSubmit}>
					<Custom_InputBox options={this.state.filenames} onChange={this.onChange} /> 
					<br/>
					<Button type='submit'variant="contained" color="primary" >Submit</Button>
					</form>
				</CardBody>
			)
	}

	render() {
		return (
			  <Card className="bg-secondary shadow border-0" style={{ width: '30rem'}}>
		        {this.generatecard()}
			  </Card>
		);
	}
}

VulnerabilitySearchForm.propTypes = {
}

function mapStateToProps(state) {
	return {

	};
}

export default connect(mapStateToProps, {})(withRouter(VulnerabilitySearchForm));